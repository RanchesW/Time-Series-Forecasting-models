# Дорожная карта для реализации Prophet с целью оптимизации запасов топлива и предотвращения избыточных запасов

## Сбор и подготовка данных

**Задача:** Сбор исторических данных о потреблении топлива для каждой заправки.

**Детали:** Включите данные за каждый час в течение месяца. Убедитесь, что данные очищены и правильно отформатированы.

**Действие:** Загрузите данные в DataFrame Pandas и подготовьте их для анализа, переименовав столбцы в ds (дата и время) и y (потребление).

## Установка и настройка

**Задача:** Установите Prophet и другие необходимые библиотеки.

**Детали:** Используйте pip для установки библиотеки Prophet и импортируйте необходимые модули Python.

**Действие:** Запустите *!pip install prophet* и импортируйте нужные библиотеки, такие как Pandas и Matplotlib.

## Обучение модели

**Задача:** Обучите модель Prophet на исторических данных.

**Детали:** Инициализируйте модель Prophet и обучите её на данных.

**Действие:** Используйте код ниже для её обучения.

```
Prophet(yearly_seasonality=True, weekly_seasonality=True, daily_seasonality=True) для создания модели и model.fit(df)
```

## Прогнозирование

**Задача:** Создайте прогнозы на будущее потребление топлива.

**Детали:** Создайте DataFrame на будущее на следующие 30 дней (по часам) и предскажите будущее потребление.

**Действие:** Используйте для создания будущих дат:

```
model.make_future_dataframe(periods=24*30, freq='H') 
```

и для генерации прогнозов:

```
model.predict(future) 
```

## Оценка и корректировка

**Задача:** Оцените прогноз и при необходимости скорректируйте параметры модели.

**Детали:** Постройте график прогноза для визуализации предсказаний и при необходимости скорректируйте параметры, такие как changepoint_prior_scale.

**Действие:** Используйте для визуализации:

```
model.plot(forecast)
```

и при необходимости скорректируйте параметры с помощью:

```
Prophet(changepoint_prior_scale=0.1).
```

## Учет внешних факторов

**Задача:** Включите праздники и другие внешние факторы, которые могут повлиять на потребление топлива.

**Детали:** Создайте DataFrame с датами праздников и интегрируйте его в модель Prophet.

**Действие:** Определите праздники и обучите модель снова с учетом DataFrame праздников.

## Развертывание

**Задача:** Сохраните обученную модель для будущего использования и загрузите её при необходимости.

**Детали:** Сериализуйте модель в формате JSON и сохраните её в файл.

**Действие:** Используйте model_to_json и model_from_json для сохранения и загрузки модели.

## Мониторинг и обновление

**Задача:** Регулярно обновляйте модель новыми данными для поддержания её точности.

**Детали:** Периодически проверяйте наличие новых данных, обновляйте DataFrame и переобучайте модель.

**Действие:** Объедините новые данные с существующим DataFrame и переобучите модель.

## Визуализация

**Задача:** Визуализируйте фактическое и прогнозируемое потребление топлива.

**Детали:** Создайте графики для сравнения исторических данных с прогнозируемыми значениями и сохраните графики.

**Действие:** Используйте Matplotlib для построения графиков и сохраните график в файл изображения.

## Визуальное понимание цели

![newplot (2)](https://github.com/user-attachments/assets/afecb745-3362-4572-bcd9-812fea24762f)

## 10. Результаты необученной модели

![image](https://github.com/user-attachments/assets/92a08cea-61a2-4eca-a806-253cab10e65e)

### 1. Описание графика

График визуализирует исторические данные о потреблении топлива (синим цветом) вместе с прогнозируемыми данными о потреблении топлива (оранжевым цветом). Исторические данные охватывают период с 1 июля 2024 года по 31 июля 2024 года с почасовыми измерениями. Прогноз охватывает период с 1 августа 2024 года по 31 августа 2024 года.

+ **Исторические данные**: Синяя линия представляет фактическое потребление топлива, зафиксированное на заправках. Данные показывают четкий почасовой рисунок, с пиками и спадами, указывающими на различные уровни потребления топлива в течение дня.

+ **Прогнозируемые данные:** Оранжевая пунктирная линия представляет прогнозируемое потребление топлива на следующий месяц. Прогноз следует за наблюдаемыми тенденциями и сезонными моделями из исторических данных.

Цель этой визуализации — убедиться, что модель Prophet точно улавливает шаблоны потребления и предоставляет прогнозы для оптимизации запасов и предотвращения избыточных запасов.


![image](https://github.com/user-attachments/assets/81e335ac-c741-489e-a9b8-21afd1cf5926)

### 2. Описание графика

График визуализирует исторические данные о потреблении топлива (черными точками) и прогнозируемые значения (синими линиями) с прогнозируемым интервалом неопределенности (светло-синим цветом). Исторические данные охватывают период с 30 июня 2024 года по 31 июля 2024 года, с почасовыми измерениями. Прогноз охватывает период с 1 августа 2024 года по 1 сентября 2024 года.

### Детали графика:

 **1. Исторические данные (черные точки):**

  - Черные точки представляют фактическое потребление топлива на каждой заправке за указанный период времени.
    
  - Видно, что потребление топлива варьируется в зависимости от времени суток, недели и других факторов.
    
 **2. Прогнозируемые значения (синие линии):**

  - Синие линии представляют прогнозируемое потребление топлива, основанное на модели Prophet.

  - Прогноз учитывает сезонные тренды и закономерности, выявленные в исторических данных.

  **3. Интервалы неопределенности (светло-синие области):**

  - Светло-синие области вокруг прогнозируемых значений показывают интервалы неопределенности модели.
  
  - Эти интервалы демонстрируют возможные колебания прогнозируемых значений, учитывая вариации в данных.

### Цель графика:

Цель данной визуализации — показать, как модель Prophet предсказывает будущее потребление топлива, опираясь на исторические данные. График помогает визуально оценить точность прогнозов и понять, насколько модель хорошо справляется с прогнозированием на основе имеющихся данных.

### Выводы:

- Потребление топлива имеет четкие закономерности: Исторические данные показывают регулярные пики и спады, что указывает на суточные и недельные циклы потребления топлива.
- Прогнозируемое потребление: Модель Prophet успешно захватывает эти циклы и предсказывает будущие значения с учетом выявленных закономерностей.
- Интервалы неопределенности: Учитывают возможные вариации и показывают диапазон, в котором, вероятно, будет находиться фактическое потребление топлива.

## Пример скрипта для дорожной карты:

```
import os
import pandas as pd
from prophet import Prophet
from prophet.serialize import model_to_json, model_from_json
import matplotlib.pyplot as plt

# Создание необходимых директорий
os.makedirs('plots', exist_ok=True)

# Сбор и подготовка данных
df = pd.read_csv('gas_consumption.csv')
df.rename(columns={'datetime': 'ds', 'gas_consumption': 'y'}, inplace=True)
df['ds'] = pd.to_datetime(df['ds'])

# Обучение модели
model = Prophet(yearly_seasonality=True, weekly_seasonality=True, daily_seasonality=True)
model.fit(df)

# Прогнозирование
future = model.make_future_dataframe(periods=24*30, freq='H')
forecast = model.predict(future)

# Оценка и корректировка
fig = model.plot(forecast)

# Настройка гиперпараметров для улучшения точности
model = Prophet(changepoint_prior_scale=0.1)
model.fit(df)

# Учет внешних факторов (праздники)
holidays = pd.DataFrame({
    'holiday': 'holiday_name',
    'ds': pd.to_datetime(['2024-12-25', '2024-01-01']),
    'lower_window': 0,
    'upper_window': 1,
})
model = Prophet(holidays=holidays)
model.fit(df)

# Развертывание модели
with open('model.json', 'w') as fout:
    fout.write(model_to_json(model))

# Загрузка модели для реального использования
with open('model.json', 'r') as fin:
    model = model_from_json(fin.read())

# Мониторинг и обновление модели, если новые данные доступны
if os.path.exists('new_fuel_data.csv'):
    new_data = pd.read_csv('new_fuel_data.csv')
    new_data.rename(columns={'datetime': 'ds', 'gas_consumption': 'y'}, inplace=True)
    new_data['ds'] = pd.to_datetime(new_data['ds'])
    df = pd.concat([df, new_data])
    model.fit(df)

# Визуализация обновленного прогноза
future = model.make_future_dataframe(periods=24*30, freq='H')
forecast = model.predict(future)
fig = model.plot(forecast)

# Сохранение прогноза
forecast.to_csv('fuel_forecast.csv', index=False)

# Визуализация прогноза
plt.figure(figsize=(14, 7))
plt.plot(df['ds'], df['y'], label='Actual')
plt.plot(forecast['ds'], forecast['yhat'], label='Forecast', linestyle='--')
plt.xlabel('Date')
plt.ylabel('Fuel Consumption')
plt.title('Fuel Consumption Forecast vs Actual')
plt.legend()
plt.savefig('plots/forecast_plot.png')
plt.show()

```
